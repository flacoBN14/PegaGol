generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  nombre    String
  salon     String
  createdAt DateTime @default(now()) @map("created_at")

  stickers        UserSticker[]
  sentTrades      Trade[]   @relation("TradeFrom")
  receivedTrades  Trade[]   @relation("TradeTo")
  sentMessages    Message[] @relation("MessageSender")
  receivedMessages Message[] @relation("MessageReceiver")

  @@map("users")
}

model Sticker {
  id            Int    @id @default(autoincrement())
  codigo        String @unique
  equipo        String
  nombreJugador String @map("nombre_jugador")
  numero        Int

  userStickers  UserSticker[]
  offerTrades   Trade[] @relation("OfferSticker")
  requestTrades Trade[] @relation("RequestSticker")

  @@map("stickers")
}

model UserSticker {
  id        Int @id @default(autoincrement())
  userId    Int @map("user_id")
  stickerId Int @map("sticker_id")
  cantidad  Int @default(1)

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  sticker Sticker @relation(fields: [stickerId], references: [id], onDelete: Cascade)

  @@unique([userId, stickerId])
  @@map("user_stickers")
}

model Trade {
  id              Int      @id @default(autoincrement())
  fromUserId      Int      @map("from_user_id")
  toUserId        Int      @map("to_user_id")
  offerStickerId  Int      @map("offer_sticker_id")
  requestStickerId Int     @map("request_sticker_id")
  status          String   @default("pending")
  createdAt       DateTime @default(now()) @map("created_at")

  fromUser       User    @relation("TradeFrom", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser         User    @relation("TradeTo", fields: [toUserId], references: [id], onDelete: Cascade)
  offerSticker   Sticker @relation("OfferSticker", fields: [offerStickerId], references: [id], onDelete: Cascade)
  requestSticker Sticker @relation("RequestSticker", fields: [requestStickerId], references: [id], onDelete: Cascade)

  @@map("trades")
}

model Message {
  id         Int      @id @default(autoincrement())
  senderId   Int      @map("sender_id")
  receiverId Int      @map("receiver_id")
  content    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now()) @map("created_at")

  sender   User @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("messages")
}
